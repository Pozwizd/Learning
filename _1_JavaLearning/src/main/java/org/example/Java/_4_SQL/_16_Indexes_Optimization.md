# 16. Индексы и Оптимизация (Indexes & Optimization)

Индекс — это структура данных (обычно B-Tree), которая ускоряет поиск строк, работая как указатель в книге. Без индекса СУБД выполняет **Full Table Scan** (просмотр всех строк).

## Типы индексов
1.  **B-Tree (Balanced Tree)**: Стандартный тип. Отлично подходит для диапазонов (`<`, `>`, `BETWEEN`), сортировки и точного совпадения.
2.  **Hash Index**: Только для точного совпадения (`=`). Очень быстрый, но не поддерживает диапазоны.
3.  **Bitmap Index**: Эффективен для столбцов с малым количеством уникальных значений (пол, статус), но медленный на запись.
4.  **GIN / GiST**: Для полнотекстового поиска, JSON, геометрии (PostgreSQL).

## Кластеризация
*   **Clustered Index (Кластерный)**: Сами данные таблицы физически отсортированы по ключу индекса. В таблице может быть только один кластерный индекс (обычно это Primary Key).
*   **Non-Clustered Index (Некластерный)**: Отдельная структура, содержащая копию индексируемых столбцов и ссылку на строку данных.

## EXPLAIN (План выполнения)
Команда `EXPLAIN` показывает, как СУБД планирует выполнять запрос.

```sql
EXPLAIN SELECT * FROM Users WHERE Name = 'Alice';
```
**На что смотреть**:
*   **Seq Scan / Table Scan**: Полное сканирование таблицы (плохо на больших данных).
*   **Index Scan / Index Seek**: Использование индекса (хорошо).
*   **Cost**: Оценка стоимости операции.

## Советы по оптимизации
1.  **Индексируйте** столбцы, часто используемые в `WHERE`, `JOIN`, `ORDER BY`.
2.  **Избегайте `SELECT *`**: Выбирайте только нужные столбцы.
3.  **SARGable запросы**: Пишите условия так, чтобы можно было использовать индекс.
    *   Плохо: `WHERE YEAR(OrderDate) = 2023` (функция на столбце убивает индекс).
    *   Хорошо: `WHERE OrderDate >= '2023-01-01' AND OrderDate < '2024-01-01'`.
4.  **Избегайте `%` в начале LIKE**: `LIKE '%text'` не использует индекс. `LIKE 'text%'` — использует.
